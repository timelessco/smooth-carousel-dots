"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
/**
 * @since 2019-07-31 14:28
 * @author vivaxy
 */
const path = require("path");
const fse = require("fs-extra");
const helpers_1 = require("../helpers");
async function getAllSubmodules({ cwd, }) {
    const gitModulesPath = path.join(cwd, '.gitmodules');
    if (!(await fse.pathExists(gitModulesPath))) {
        return [];
    }
    const submodulesFileContent = await fse.readFile(gitModulesPath, 'utf8');
    const submodules = [];
    const lines = submodulesFileContent.split('\n');
    let lineIndex = 0;
    while (lineIndex < lines.length) {
        let line = lines[lineIndex];
        if (line.startsWith('[submodule ')) {
            const name = helpers_1.trim(line.slice('[submodule '.length, -']'.length), '"');
            const submodule = {
                name,
                path: '',
                url: '',
            };
            lineIndex++;
            while (lineIndex < lines.length &&
                (line = lines[lineIndex]) &&
                !line.startsWith('[submodule ')) {
                const [key, value] = line.split('=').map(function (s) {
                    return s.trim();
                });
                if (key === 'path' || key === 'url') {
                    submodule[key] = value;
                }
                lineIndex++;
            }
            submodules.push(submodule);
            continue;
        }
        lineIndex++;
    }
    return submodules;
}
exports.default = getAllSubmodules;
